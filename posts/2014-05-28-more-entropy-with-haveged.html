<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Fraser's IdM Blog - More entropy with <code>haveged</code></title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Fraser's IdM Blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <div class="info">
    
    Tags: <a href="../tags/sysadmin.html">sysadmin</a>
    
</div>

<div id="postContent">
    <h1 id="more-entropy-with-haveged">More entropy with <code>haveged</code></h1>
<p>When a system’s entropy pool is depleted, reads from <code>/dev/random</code> will block. For applications that require lots of entropy, in environments where little entropy is available, long delays can result.</p>
<p>A side-note: on Linux, information about the amount of entropy available can be found under <code>/proc/sys/kernel/random/</code>, along with other parameters of the kernel entropy device and a UUID source. Be aware that other systems may not have this interface.</p>
<p>So if you <em>are</em> running out of entropy, what can you do? The <a href="http://www.issihosts.com/haveged/">haveged</a> program exists to remedy this problem. It implements a variant of the <a href="http://www.irisa.fr/caps/projects/hipsor/">HAVEGE</a> (<strong>HA</strong>rdware <strong>V</strong>olatile <strong>E</strong>ntropy <strong>G</strong>athering and <strong>E</strong>xpansion) algorithm. In brief, HAVEGE leverages the fact that modern processors have thousands of bits of volatile internal state that affect how long it takes to execute particular routines. The nondeterminism in the time taken to execute a particular routine, also known as <em>flutter</em>, can be determined by reading the hardware clock counter. Using this entropy to seed a PRNG, HAVEGE can provide orders of magnitude more entropy than the standard Linux entropy device.</p>
<p>Let’s install <code>haveged</code> and see it in action:</p>
<pre><code>sudo yum install -y haveged
sudo systemctl start haveged.service</code></pre>
<p>That’s all there is to it. This runs <code>/usr/sbin/haveged -w 1024 -v 1 --Foreground</code>. The <code>-w</code> argument specifies the <em>write wakeup threshold</em>. When <code>/dev/random</code> has fewer than this many bits of entropy available, processes writing to the entropy pool are awakened. <code>haveged</code> wakes up, produces some entropy and feeds it to Linux for other applications to use.</p>
<p>The availability and quality of entropy can be tested using the <code>rngtest</code> tool, available in the <code>rng-tools</code> package. Compare running <code>cat /dev/random | rngtest -c 1000</code> both with and without <code>haveged</code> working to feed <code>/dev/random</code>. You should find that <code>haveged</code> does a good job of ensuring ample entropy is available for programs.</p>
<p><a href="http://www.issihosts.com/haveged/history.html#other">Another solution</a> to low entropy on Linux is <code>rngd</code>, which works similarly to <code>haveged</code> but reads entropy from hardware RNGs. Of course, you need a hardware RNG for <code>rngd</code> to be effective. The default location for a hardware RNG is <code>/dev/hwrandom</code>; <code>rngd</code> uses this device by default but can be configured to use any device that provides the Linux <code>/dev/random</code> ioctl API. Some Linux distributions (including recent releases of Fedora) ship with <code>rngd</code> enabled by default.</p>
<p>Let it again be noted that the entropy devices provided by other operating systems may (read: <em>do</em>) operate differently from the Linux entropy device, and some have native support for hardware RNGs when present, so while the approach to entropy replenishment shared by <code>haveged</code> and <code>rngd</code> works well for Linux, it may be incorrect or simply unnecessary for other systems.</p>
</div>
<div id="postFooter">
    <div id="recent">
Recent posts:
<ul>
    
        <li>
            <a href="../posts/2019-12-12-certmonger-disable-auto-renew.html">Disabling Certmonger auto-renewal</a>
        </li>
    
        <li>
            <a href="../posts/2019-12-06-freeipa-acme-plans.html">Plans for ACME support in FreeIPA</a>
        </li>
    
        <li>
            <a href="../posts/2019-10-24-removing-ipa-ca.html">Removing the CA from a FreeIPA deployment</a>
        </li>
    
        <li>
            <a href="../posts/2019-09-23-direct-integration-ipa-certs.html">Requesting certificates from FreeIPA on Active Directory clients</a>
        </li>
    
        <li>
            <a href="../posts/2019-08-02-validity-exceeding-ca.html">Certificates need not be limited to the CA’s validity period</a>
        </li>
    
</ul>

<div id="recentLinks">
    <a type="application/atom+xml" href="../atom.xml">Atom feed</a>
     <!-- em space -->
    <a href="../archive.html">All posts…</a>
</div>

</div>

    <div id="license">
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by/4.0/88x31.png">
    </a>
    <br />
    Except where otherwise noted, this work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
        Creative Commons Attribution 4.0 International License
    </a>.
</div>

</div>

        </div>
        <div class="clear"></div>
        <div id="footer">
            Generated by
            <a href="https://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
