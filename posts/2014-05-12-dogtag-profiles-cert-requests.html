<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Fraser's IdM Blog - Dogtag certificate profiles - certificate requests</title>
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
    </head>
    <body>
        <div id="header">
            <div id="logo">
                <a href="../">Fraser's IdM Blog</a>
            </div>
            <div id="navigation">
                <a href="../">Home</a>
                <a href="../archive.html">Archive</a>
            </div>
        </div>

        <div id="content">
            <div class="info">
    
    Tags: <a title="All pages tagged 'dogtag'." href="../tags/dogtag.html" rel="tag">dogtag</a>
    
</div>

<div id="postContent">
    <h1 id="dogtag-certificate-profiles---certificate-requests">Dogtag certificate profiles - certificate requests</h1>
<p>The <em>certificate enrolment profiles</em> feature of Dogtag PKI can be
used to specify default values and constraints for X.509 certificate
fields. This post explores Dogtag certificate profiles and their
relationship with the PKCS #10 certificate signing request (CSR)
format with a focus on signing request submission. Future posts in
this series will focus on the Certificate Authority (CA) side of the
profiles feature, and on modifying and defining profiles for
specialised use cases.</p>
<p>Let us begin by generating a CSR. This occurs in isolation from
Dogtag profiles or certificate enrolment, and is done using
<code>certutil</code> (CSRs can also be generated with <code>openssl req</code>).</p>
<pre><code>certutil -R -d .pki/nssdb -o no-CN.req -a -s 'C=AU, ST=Queensland, L=Brisbane, O=Red Hat'</code></pre>
<p>The <code>-o no-CN.req</code> instructs <code>certutil</code> to output the CSR to a file,
while <code>-a</code> specifies ASCII output. Note that the subject (given
by <code>-s</code>) does not contain a common name (CN) component.</p>
<p>CSRs are submitted to Dogtag in the context of some certificate
profile. Available profiles can be listed via <code>pki cert-request-profile-find ""</code>, and the Certificate Enrolment
Request template for a profile can be retrieved via <code>pki cert-request-profile-show &lt;profile ID&gt; --output &lt;filename&gt;</code>.
Let’s have a look at the <code>caServerCert</code> profile template:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;UTF-8&quot;</span><span class="ot"> standalone=</span><span class="st">&quot;yes&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">CertEnrollmentRequest</span>&gt;</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">ProfileID</span>&gt;caServerCert&lt;/<span class="kw">ProfileID</span>&gt;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">Renewal</span>&gt;false&lt;/<span class="kw">Renewal</span>&gt;</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">SerialNumber</span>&gt;&lt;/<span class="kw">SerialNumber</span>&gt;</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">RemoteHost</span>&gt;&lt;/<span class="kw">RemoteHost</span>&gt;</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">RemoteAddress</span>&gt;&lt;/<span class="kw">RemoteAddress</span>&gt;</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">Input</span><span class="ot"> id=</span><span class="st">&quot;i1&quot;</span>&gt;</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">ClassID</span>&gt;certReqInputImpl&lt;/<span class="kw">ClassID</span>&gt;</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Name</span>&gt;Certificate Request Input&lt;/<span class="kw">Name</span>&gt;</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;cert_request_type&quot;</span>&gt;</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Value</span>&gt;&lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;cert_request_type&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Certificate Request Type&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;cert_request&quot;</span>&gt;</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Value</span>&gt;&lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;cert_request&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Certificate Request&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">Input</span>&gt;</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">Input</span><span class="ot"> id=</span><span class="st">&quot;i2&quot;</span>&gt;</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">ClassID</span>&gt;submitterInfoInputImpl&lt;/<span class="kw">ClassID</span>&gt;</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Name</span>&gt;Requestor Information&lt;/<span class="kw">Name</span>&gt;</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;requestor_name&quot;</span>&gt;</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Value</span>&gt;&lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;string&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Requestor Name&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;requestor_email&quot;</span>&gt;</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Value</span>&gt;&lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;string&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Requestor Email&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;requestor_phone&quot;</span>&gt;</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Value</span>&gt;&lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;string&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Requestor Phone&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">Input</span>&gt;</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">CertEnrollmentRequest</span>&gt;</span></code></pre></div>
<p>The template is XML, containing <em>fields</em> with <em>attributes</em> whose
values are not yet specified. Filling out these attributes with
the content of the CSR generated earlier along with some ancillary
information, we end up with the following:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode xml"><code class="sourceCode xml"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">&lt;?xml</span><span class="ot"> version=</span><span class="st">&quot;1.0&quot;</span><span class="ot"> encoding=</span><span class="st">&quot;UTF-8&quot;</span><span class="ot"> standalone=</span><span class="st">&quot;yes&quot;</span><span class="fu">?&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>&lt;<span class="kw">CertEnrollmentRequest</span>&gt;</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">ProfileID</span>&gt;caServerCert&lt;/<span class="kw">ProfileID</span>&gt;</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">Renewal</span>&gt;false&lt;/<span class="kw">Renewal</span>&gt;</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">SerialNumber</span>&gt;&lt;/<span class="kw">SerialNumber</span>&gt;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">RemoteHost</span>&gt;&lt;/<span class="kw">RemoteHost</span>&gt;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">RemoteAddress</span>&gt;&lt;/<span class="kw">RemoteAddress</span>&gt;</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">Input</span><span class="ot"> id=</span><span class="st">&quot;i1&quot;</span>&gt;</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">ClassID</span>&gt;certReqInputImpl&lt;/<span class="kw">ClassID</span>&gt;</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Name</span>&gt;Certificate Request Input&lt;/<span class="kw">Name</span>&gt;</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;cert_request_type&quot;</span>&gt;</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Value</span>&gt;pkcs10&lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;cert_request_type&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Certificate Request Type&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;cert_request&quot;</span>&gt;</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Value</span>&gt;</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>MIIBhjCB8AIBADBHMRAwDgYDVQQKEwdSZWQgSGF0MREwDwYDVQQHEwhCcmlzYmFu</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>ZTETMBEGA1UECBMKUXVlZW5zbGFuZDELMAkGA1UEBhMCQVUwgZ8wDQYJKoZIhvcN</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>AQEBBQADgY0AMIGJAoGBAJvkY6CyMdY0u7hwFzfG9ZdajT+69bbRh1vqFIArGhhv</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>vL09Em2MrlAhQEKF6PuAcdED7U7ryoBByeXDRfivFwQS5W5msVBkA5gZ1i9LyH82</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>xULvkdnNFu6He8QnxLr8+bl/r9tdlktP/3k79hHmWRpqBtOqVKtBCwMqEdPltF7H</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>AgMBAAGgADANBgkqhkiG9w0BAQUFAAOBgQB5Slu71g30osgQd25puSrUxNf6+eQk</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>KEpWfrsrpRh7nOkAo3QmBmR4L7i5tUChnIv6UGi8qTeEWNHnMBcwgoe56tg5vqpK</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>mmaz3W1w8hxima/cSqzqWgw4U/JMDU1nBSYz2WJTyEUUvdDD1lSsWzrqFi5f/vC3</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>VjjWvio/DSvrgw==</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>                &lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;cert_request&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Certificate Request&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">Input</span>&gt;</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    &lt;<span class="kw">Input</span><span class="ot"> id=</span><span class="st">&quot;i2&quot;</span>&gt;</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">ClassID</span>&gt;submitterInfoInputImpl&lt;/<span class="kw">ClassID</span>&gt;</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Name</span>&gt;Requestor Information&lt;/<span class="kw">Name</span>&gt;</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;requestor_name&quot;</span>&gt;</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Value</span>&gt;ftweedal&lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;string&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Requestor Name&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;requestor_email&quot;</span>&gt;</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Value</span>&gt;ftweedal@redhat.com&lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;string&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Requestor Email&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>        &lt;<span class="kw">Attribute</span><span class="ot"> name=</span><span class="st">&quot;requestor_phone&quot;</span>&gt;</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Value</span>&gt;&lt;/<span class="kw">Value</span>&gt;</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>            &lt;<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Syntax</span>&gt;string&lt;/<span class="kw">Syntax</span>&gt;</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>                &lt;<span class="kw">Description</span>&gt;Requestor Phone&lt;/<span class="kw">Description</span>&gt;</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>            &lt;/<span class="kw">Descriptor</span>&gt;</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        &lt;/<span class="kw">Attribute</span>&gt;</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    &lt;/<span class="kw">Input</span>&gt;</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>&lt;/<span class="kw">CertEnrollmentRequest</span>&gt;</span></code></pre></div>
<p>With these fields filled out, the enrolment request can now be
submitted to Dogtag:</p>
<pre><code>$ pki cert-request-submit no-CN-req.xml
-----------------------------
Submitted certificate request
-----------------------------
  Request ID: 12
  Type: enrollment
  Request Status: rejected
  Operation Result: success</code></pre>
<p>Boo! The enrolment request was rejected. Why? Certificate
profiles can specify constraints on user-supplied values in a
certificate request. In this case, it was the lack of a <code>CN</code>
field in the subject, but profiles can also summarily reject an
enrolment request based on other aspects of the embedded CSR,
including key type and size.</p>
<p>Let’s now bring some extensions into the mix by generating a new
signing request - this time with a valid subject, and with the <em>Key
Usage</em> extension configured to indicate a certificate signing
certificate (i.e., an intermediate CA). It obviously makes no
sense to have this extensions on a server certificate, but let’s
submit it with the <code>caServerCert</code> profile again and see what
happens.</p>
<pre><code>$ certutil -R -d .pki/nssdb -o usage-ca.req -a --keyUsage certSigning -s 'CN=c2.vm-096.idm.lab.bos.redhat.com'
...
$ openssl req -text &lt; usage-ca.req
Certificate Request:
    Data:
        Version: 0 (0x0)
        Subject: CN=c2.vm-096.idm.lab.bos.redhat.com
        Subject Public Key Info:
            Public Key Algorithm: rsaEncryption
                Public-Key: (1024 bit)
                Modulus:
                    00:bc:6e:11:11:6f:e5:3c:34:03:8a:5f:92:41:44:
                    ...
                    9b:bf:86:8e:df:96:9e:e6:ef
                Exponent: 65537 (0x10001)
        Attributes:
        Requested Extensions:
            X509v3 Key Usage:
                Certificate Sign
    Signature Algorithm: sha1WithRSAEncryption
         b0:4a:19:2c:c1:36:07:db:6a:bb:a9:36:0b:a4:53:c9:39:6d:
         ...</code></pre>
<p>We can see that Key Usage extension is present in the request, and
contains (only) the <em>Certificate Sign</em> declaration. We fill out and
submit the enrolment request with this CSR:</p>
<pre><code>$ pki cert-request-submit usage-ca-req.xml
-----------------------------
Submitted certificate request
-----------------------------
  Request ID: 14
  Type: enrollment
  Request Status: pending
  Operation Result: success</code></pre>
<p>Perhaps surprisingly, this succeeds and the enrolment request is now
<em>pending</em>, waiting for approval (or rejection) by a CA agent. It
seems that, at least for the <code>caServerCert</code> profile, the value of
the Key Usage extension in a CSR is ignored. The agent interface
does allow adjustment of the Key Usage extension, however, and
enforces sensible constraints, so no request submitted in the
<code>caServerCert</code> profile will ever result in a certificate that
could be used as an intermediate CA.</p>
<p>We have seen that Dogtag ignores the Key Usage extension information
present in a CSR, but in fact, Dogtag ignores <em>all</em> information in
the CSR except for what it specifically extracts. Therefore,
requesting a particular key signing algorithm does not necessarily
result in a certificate signed using that algorithm, and requesting
some extension unknown in the selected profile (e.g., the
<em>Certificate Policies</em> extension, which can be included in a CSR via
the <code>--extCP</code> argument to <code>certmonger</code>) will <strong>certainly not</strong>
be present in the certificate.</p>
<p>As a newcomer to the Dogtag PKI I find this behaviour somewhat
limiting and would like to investigate whether the profiles system
supports profiles that afford more control over the presense of
extensions or the signing process, or what it would take to get this
support.</p>
<p>The next post in this series will investigate how profiles are
defined and the kinds of inputs and constraints they support.</p>
</div>
<div id="postFooter">
    <div id="recent">
Recent posts:
<ul>
    
        <li>
            <a href="../posts/2023-02-02-freeipa-pkinit-certmap-vuln.html">CVE-2022-4254: FreeIPA PKINIT certificate mapping vulnerability</a>
        </li>
    
        <li>
            <a href="../posts/2023-01-22-openshift-feature-gates.html">Enabling Kubernetes feature gates in OpenShift</a>
        </li>
    
        <li>
            <a href="../posts/2022-08-29-jax-rs-header-formatting.html">Controlling header formatting in JAX-RS applications</a>
        </li>
    
        <li>
            <a href="../posts/2022-03-24-k8s-external-dns.html">Experimenting with ExternalDNS</a>
        </li>
    
        <li>
            <a href="../posts/2022-02-02-openshift-user-ns-without-anyuid.html">Running Pods in user namespaces without privileged SCCs</a>
        </li>
    
</ul>

<div id="recentLinks">
    <a type="application/atom+xml" href="../atom.xml">Atom feed</a>
     <!-- em space -->
    <a href="../archive.html">All posts…</a>
</div>

</div>

    <div id="license">
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
        <img alt="Creative Commons License" style="border-width:0" src="https://licensebuttons.net/l/by/4.0/88x31.png">
    </a>
    <br />
    Except where otherwise noted, this work is licensed under a
    <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">
        Creative Commons Attribution 4.0 International License
    </a>.
</div>

</div>

        </div>
        <div class="clear"></div>
        <div id="footer">
            Generated by
            <a href="https://jaspervdj.be/hakyll">Hakyll</a>
        </div>
    </body>
</html>
